{% extends "base.html" %}
{% block title %}SmartBus Buddy - Route Plan{% endblock %}
{% block content %}
{% load static %}
{% load crispy_forms_tags %}

<style>
    /* Add spacing to form fields */
    .custom-form .form-group {
      margin-bottom: 10px; /* Adjust as needed */
    }
  </style>
<div class="osahan-verification padding-bt">
    <div class="p-3 shadow bg-danger danger-nav osahan-home-header">
       <div class="font-weight-normal mb-0 d-flex align-items-center">
          <img src="{% static 'img/logo.png' %}" class="img-fluid osahan-nav-logo">  <h5 class="font-weight-normal mb-0 text-white">&nbsp;<strong>SmartBus Buddy</h5></strong>
          <div class="ml-auto d-flex align-items-center">
             <a href="#" class="mr-3"><img src="{% static 'img/user1.png' %}" class="img-fluid rounded-circle"></a>
             <a class="toggle osahan-toggle h4 m-0 text-white ml-auto" href="#"><i class="icofont-navigation-menu"></i></a>
          </div>
       </div>
    </div>
    <div class="bg-danger px-3 pb-3">
       <div class="bg-white rounded-1 p-3">
         <form method="get" action="{% url 'display_route' %}" class="custom-form" style="margin-bottom: 10px;">
            {% csrf_token %}
            <div class="form-group border-bottom pb-2">
               <input type="checkbox" id="getLocationBtn">
               <label class="form-check-label" for="autoLocation">Use My Current Location</label>
               
               <input type="text" id="postalCodeText" readonly style="display: none;">
                
                {{ form.from_post_code|as_crispy_field }}
                {{ form.to_post_code|as_crispy_field }}
                {{ form.date_time|as_crispy_field }}
                <button type="submit" class="btn btn-danger btn-block osahanbus-btn rounded-1">Search</button>
            </div>
        </form>
        
       </div>
    </div>
    <div class="p-3 bg-warning">
       <div class="row m-0">
          <div class="col-6 py-1 pr-1 pl-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
                <img class="img-fluid" src="{% static 'img/safe-vehicles.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Plan Journey<br>
             </div>
          </div>
          <div class="col-6 py-1 pl-1 pr-0">
            <div class="p-3 bg-white shadow-sm rounded-1">
                <a href="{% url 'reviews:review_create' %}">
                    <img class="img-fluid" src="{% static 'img/customer-support.svg' %}" alt="">
                    <p class="mb-0 mt-4 font-weight-bold">Review Buses</p>
                </a>
            </div>
        </div>
        
          <div class="col-6 py-1 pr-1 pl-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
                <img class="img-fluid" src="{% static 'img/live-tracking.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Bus Time Table<br>
             </div>
          </div>
          <div class="col-6 py-1 pl-1 pr-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
               <a href="{% url 'bus_detail' %}">
                <img class="img-fluid" src="{% static 'img/safe-vehicles.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Bus Detail<br>
                </a>
             </div>
          </div>
       </div>
    </div>
    
 <!-- Footer Fixed -->
 
 <script>
   const getLocationBtn = document.getElementById('getLocationBtn');
   const postalCodeText = document.getElementById('postalCodeText');
   const fromPostCodeInput = document.querySelector('input[name="from_post_code"]');

   getLocationBtn.addEventListener('click', () => {
       if ("geolocation" in navigator) {
           navigator.geolocation.getCurrentPosition(function(position) {
               const latitude = position.coords.latitude;
               const longitude = position.coords.longitude;

               // Make a request to OpenCageData API to get location information
               fetch(`https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=a2003125b81348a1b9011350c8d00197`)
                   .then(response => response.json())
                   .then(data => {
                       if (data.results.length > 0) {
                           const postalCode = data.results[0].components.postcode;
                           postalCodeText.value = postalCode || "Postal code not found";

                           // Set the postal code in the form's field
                           fromPostCodeInput.value = postalCode || "";
                       } else {
                           postalCodeText.value = "Location not found";

                           // Clear the form's field
                           fromPostCodeInput.value = "";
                       }
                   })
                   .catch(error => {
                       console.error("Error fetching location data:", error);
                       postalCodeText.value = "Error fetching location data";

                       // Clear the form's field
                       fromPostCodeInput.value = "";
                   });
           });
       } else {
           postalCodeText.value = "Geolocation is not supported by your browser";

           // Clear the form's field
           fromPostCodeInput.value = "";
       }
   });
</script>

      
{% endblock %}
