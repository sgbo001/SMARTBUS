{% extends "base.html" %}

{% block content %}
{% load static %}
{% load crispy_forms_tags %}

<style>
    /* Add spacing to form fields */
    .custom-form .form-group {
      margin-bottom: 10px; /* Adjust as needed */
    }
  </style>
<div class="osahan-verification padding-bt">
    <div class="p-3 shadow bg-danger danger-nav osahan-home-header">
       <div class="font-weight-normal mb-0 d-flex align-items-center">
          <img src="{% static 'img/logo.png' %}" class="img-fluid osahan-nav-logo">  <h5 class="font-weight-normal mb-0 text-white">&nbsp;<strong>SMART BUS</h5></strong>
          <div class="ml-auto d-flex align-items-center">
             <a href="#" class="mr-3"><img src="{% static 'img/user1.png' %}" class="img-fluid rounded-circle"></a>
             <a class="toggle osahan-toggle h4 m-0 text-white ml-auto" href="#"><i class="icofont-navigation-menu"></i></a>
          </div>
       </div>
    </div>
    <div class="bg-danger px-3 pb-3">
       <div class="bg-white rounded-1 p-3">
         <form method="get" action="{% url 'display_route' %}" class="custom-form" style="margin-bottom: 10px;">
            {% csrf_token %}
            <div class="form-group border-bottom pb-2">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="autoLocation">
                    <label class="form-check-label" for="autoLocation">Use My Current Location</label>
                </div>
                <div id="fromPostCodeWrapper" class="d-none">
                    {{ form.from_post_code|as_crispy_field }}
                    
                </div>
                

                {{ form.to_post_code|as_crispy_field }}
                {{ form.date_time|as_crispy_field }}
                <button type="submit" class="btn btn-danger btn-block osahanbus-btn rounded-1">Search</button>
            </div>
        </form>
        
       </div>
    </div>
    <div class="p-3 bg-warning">
       <div class="row m-0">
          <div class="col-6 py-1 pr-1 pl-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
                <img class="img-fluid" src="{% static 'img/safe-vehicles.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Plan Journey<br>
             </div>
          </div>
          <div class="col-6 py-1 pl-1 pr-0">
            <div class="p-3 bg-white shadow-sm rounded-1">
                <a href="{% url 'reviews:review_create' %}">
                    <img class="img-fluid" src="{% static 'img/customer-support.svg' %}" alt="">
                    <p class="mb-0 mt-4 font-weight-bold">Review Buses</p>
                </a>
            </div>
        </div>
        
          <div class="col-6 py-1 pr-1 pl-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
                <img class="img-fluid" src="{% static 'img/live-tracking.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Bus Time Table<br>
             </div>
          </div>
          <div class="col-6 py-1 pl-1 pr-0">
             <div class="p-3 bg-white shadow-sm rounded-1">
               <a href="{% url 'bus_detail' %}">
                <img class="img-fluid" src="{% static 'img/safe-vehicles.svg' %}" alt="">
                <p class="mb-0 mt-4 font-weight-bold">Bus Detail<br>
                </a>
             </div>
          </div>
       </div>
    </div>
    
 <!-- Footer Fixed -->
 <div class="fixed-bottom p-3">
    <div class="footer-menu row m-0 bg-danger shadow rounded-2">
       <div class="col-3 p-0 text-center">
          <a href="home.html" class="home text-white active">
             <span class="icofont-ui-home h5"></span>
             <p class="mb-0 small">Home</p>
          </a>
       </div>
       <div class="col-3 p-0 text-center">
          <a href="my-ticket.html" class="home text-white">
             <span class="icofont-ticket h5"></span>
             <p class="mb-0 small">My Tickets</p>
          </a>
       </div>
       <div class="col-3 p-0 text-center">
          <a href="notification.html" class="home text-white">
             <span class="icofont-notification h5"></span>
             <small class="osahan-n">4</small>
             <p class="mb-0 small">Notice</p>
          </a>
       </div>
       <div class="col-3 p-0 text-center">
          <a href="profile.html" class="home text-white">
             <span class="icofont-user h5"></span>
             <p class="mb-0 small">Account</p>
          </a>
       </div>
    </div>
 </div>

 <script>
   document.addEventListener("DOMContentLoaded", function() {
       const autoLocationCheckbox = document.getElementById("autoLocation");
       const fromPostCodeWrapper = document.getElementById("fromPostCodeWrapper");
       const currentPostCodeInput = document.getElementById("currentPostCode");
   
       autoLocationCheckbox.addEventListener("change", function() {
           if (this.checked) {
               fromPostCodeWrapper.classList.add("d-none");
   
               // Get the user's current location and convert it to postcode
               if (navigator.geolocation) {
                   navigator.geolocation.getCurrentPosition(function(position) {
                       const latitude = position.coords.latitude;
                       const longitude = position.coords.longitude;
   
                       // Use a geocoding service or library to convert coordinates to postcode
                       // Here's a simple example using OpenCage Geocoding API
                       fetch(`https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=a2003125b81348a1b9011350c8d00197`)
                           .then(response => response.json())
                           .then(data => {
                               const postcode = data.results[0].components.postcode;
                               currentPostCodeInput.value = postcode;
   
                               // Modify this line to select the 'from_post_code' field
                               const fromPostCodeInput = document.getElementById("id_from_post_code");
                               fromPostCodeInput.value = postcode;
                           })
                           .catch(error => {
                               console.error("Error fetching postcode: ", error);
                           });
                   });
               } else {
                   console.error("Geolocation is not supported by your browser.");
               }
           } else {
               fromPostCodeWrapper.classList.remove("d-none");
               currentPostCodeInput.value = ""; // Clear the current location value
   
               // Modify this line to select the 'from_post_code' field
               const fromPostCodeInput = document.getElementById("id_from_post_code");
               fromPostCodeInput.value = ""; // Clear the 'from_post_code' field
           }
       });
   });
   </script>
      
{% endblock %}
